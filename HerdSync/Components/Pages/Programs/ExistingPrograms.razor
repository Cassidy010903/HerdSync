@page "/existingprograms"
@using BLL.Services
@using HerdSync.Shared.DTO.Program

<PageTitle>Existing Programs</PageTitle>

<div class="pa-4">
    <MudText Typo="Typo.h4">Existing Programs</MudText>
    <MudText Typo="Typo.caption">Previously saved treatment programs</MudText>
</div>

<div class="container mt-5 pt-4">
    @if (loading)
    {
        <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
    }
    else if (programs.Count == 0)
    {
        <MudAlert Severity="Severity.Info">No programs found. Create a new program first.</MudAlert>
        <MudButton Href="/program-run" Color="Color.Primary" Variant="MudBlazor.Variant.Filled" Class="mt-3">
            Create New Program Run
        </MudButton>
    }
    else
    {
        <div class="row">
            @foreach (var program in programs)
            {
                <div class="col-lg-4 col-md-6 col-12 mt-4 pt-2">
                    <div class="card border-0 bg-light rounded shadow">
                        <div class="card-body p-4">
                            <span class="badge rounded-pill bg-primary float-md-end mb-3 mb-sm-0">
                                @program.RunDate.ToString("dd MMM yyyy")
                            </span>
                            <h5>@program.ProgramTemplateCode</h5>
                            <div class="mt-3">
                                @if (program.ModifiedDate.HasValue)
                                {
                                    <span class="text-muted d-block">Last modified: @program.ModifiedDate.Value.ToString("dd MMM yyyy")</span>
                                }
                            </div>
                            <div class="mt-3">
                                <MudButton OnClick="() => StartProgram(program.ProgramRunId)"
                                           Color="Color.Success"
                                           Variant="MudBlazor.Variant.Filled">
                                    Start Program
                                </MudButton>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>